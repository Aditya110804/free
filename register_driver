import streamlit as st
import sys, os

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))
from logic import save_driver

def show():
    st.header("ðŸš— Driver Profile Setup")

    username = st.session_state.get("username")
    if not username:
        st.warning("Please log in or register first.")
        st.session_state.page = "login"
        st.rerun()
        return

    with st.form("driver_profile_form"):
        name = st.text_input("Full Name *")
        age = st.number_input("Age *", min_value=18, max_value=100)
        gender = st.selectbox("Gender *", ["Male", "Female", "Other"])
        contact = st.text_input("Contact Number *")
        vehicle_no = st.text_input("Vehicle Number *")
        driver_id = st.text_input("Driver ID *")
        national_id = st.text_input("National ID / Aadhaar *")

        submitted = st.form_submit_button("Save Profile")

        if submitted:
            required_fields = [name, contact, vehicle_no, driver_id, national_id]
            if any(not str(field).strip() for field in required_fields):
                st.error("Please fill in all required fields.")
            else:
                driver_data = {
                    "username": username,
                    "name": name.strip(),
                    "age": int(age),
                    "gender": gender,
                    "contact": contact.strip(),
                    "vehicle_no": vehicle_no.strip(),
                    "driver_id": driver_id.strip(),
                    "national_id": national_id.strip()
                }
                save_driver(driver_data)
                st.success("Driver profile saved successfully!")
                st.session_state.page = "driver_route_selection"
                st.rerun()

    if st.button("Back to Home"):
        st.session_state.page = "home"
        st.rerun()
