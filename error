def update_driver_route(username, new_route):
    """
    Upsert a driver's route:
    - If driver exists in drivers.json (by username), update their route
    - Else, fallback to create new minimal route record
    """
    drivers = load_drivers()
    updated = False

    for d in drivers:
        if d.get("username") == username:
            d["from"] = new_route["from"]
            d["to"]   = new_route["to"]
            d["date"] = new_route["date"]
            d["time"] = new_route["time"]
            updated = True
            break

    if not updated:
        # fallback if no matching driver exists, create new one
        drivers.append({
            "username": username,
            "from": new_route["from"],
            "to": new_route["to"],
            "date": new_route["date"],
            "time": new_route["time"]
        })
        updated = True

    # Save the updated list back
    if updated:
        save_json(DRIVERS_JSON, drivers)
    return updated
